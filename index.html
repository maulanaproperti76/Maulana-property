<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RumahDijual.com - Temukan Rumah Impian Anda</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    /* ... semua CSS kamu tetap sama (aku biarkan) ... */
  </style>
</head>
<body>
  <!-- Header, Hero, Property List, Property Detail, Footer -->
  <!-- (biarkan sama persis seperti kode kamu di atas) -->

  <script>
    const BACKEND_API_URL = 'https://foto-backend.vercel.app/api/photos';
    
    const propertiesContainer = document.querySelector('.properties');
    const propertyListSection = document.getElementById('properties');
    const propertyDetailSection = document.getElementById('property-detail');
    const backToListBtn = document.getElementById('backToList');
    const mainImage = document.getElementById('main-image');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const thumbnailsContainer = document.querySelector('.thumbnails');
    const detailTitle = document.getElementById('detail-title');
    const detailPrice = document.getElementById('detail-price');
    const detailAddress = document.getElementById('detail-address');
    const detailDescription = document.getElementById('detail-description');
    const detailFeatures = document.getElementById('detail-features');
    const mapLink = document.getElementById('map-link');
    const propertiesLoader = document.getElementById('properties-loader');
    const errorElement = document.getElementById('errorMessage');
    const loadButton = document.getElementById('loadData');
    const refreshButton = document.getElementById('refreshData');

    let currentProperty = null;
    let currentImageIndex = 0;
    let propertiesData = [];

    function init() {
      setupEventListeners();
      fetchAndDisplayProperties();
    }

    async function fetchAndDisplayProperties() {
      propertiesLoader.style.display = 'block';
      errorElement.style.display = 'none';
      propertiesContainer.innerHTML = '';
      try {
        const response = await fetch(BACKEND_API_URL);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const data = await response.json();
        propertiesData = data;
        if (propertiesData && propertiesData.length > 0) {
          generatePropertyCards();
        } else {
          propertiesContainer.innerHTML = '<div class="no-data">Tidak ada data properti.</div>';
        }
      } catch (error) {
        errorElement.textContent = 'Terjadi kesalahan: ' + error.message;
        errorElement.style.display = 'block';
      } finally {
        propertiesLoader.style.display = 'none';
      }
    }

    function generatePropertyCards() {
      propertiesContainer.innerHTML = '';
      propertiesData.forEach(property => {
        const card = document.createElement('div');
        card.className = 'property-card';
        const firstFoto = Array.isArray(property.foto) ? property.foto[0] : property.foto;
        card.innerHTML = `
          <div class="property-image">
            <img src="${firstFoto || 'https://via.placeholder.com/400x300'}" alt="${property.type || 'Properti'}">
          </div>
          <div class="property-details">
            <div class="property-price">${property.harga || 'N/A'}</div>
            <h3>${property.type || 'Properti'}</h3>
            <div class="property-address">${property.alamat || 'Alamat tidak tersedia'}</div>
          </div>
        `;
        card.addEventListener('click', () => showPropertyDetail(property));
        propertiesContainer.appendChild(card);
      });
    }

    function showPropertyDetail(property) {
      currentProperty = property;
      currentImageIndex = 0;

      detailTitle.textContent = property.type || 'Properti';
      detailPrice.textContent = property.harga || 'N/A';
      detailAddress.textContent = property.alamat || 'Alamat tidak tersedia';
      detailDescription.textContent = property.deskripsi || 'Tidak ada deskripsi.';
      mapLink.href = property.link || '#';

      detailFeatures.innerHTML = '';
      const features = [
        { icon: "map-marker-alt", text: property.lokasi || 'Lokasi tidak tersedia' },
        { icon: "expand", text: property.luas || 'Luas tidak tersedia' },
        { icon: "bed", text: property.kamar || 'Jumlah kamar tidak tersedia' },
        { icon: "bath", text: property.kamar_mandi || 'Jumlah kamar mandi tidak tersedia' }
      ];
      features.forEach(f => {
        const el = document.createElement('div');
        el.className = 'feature-item';
        el.innerHTML = `<i class="fas fa-${f.icon}"></i><span>${f.text}</span>`;
        detailFeatures.appendChild(el);
      });

      thumbnailsContainer.innerHTML = '';
      const images = Array.isArray(property.foto) && property.foto.length > 0
        ? property.foto
        : ['https://via.placeholder.com/600x400'];

      images.forEach((img, idx) => {
        const thumb = document.createElement('img');
        thumb.src = img;
        thumb.className = 'thumbnail';
        if (idx === 0) thumb.classList.add('active');
        thumb.addEventListener('click', () => {
          currentImageIndex = idx;
          updateMainImage();
        });
        thumbnailsContainer.appendChild(thumb);
      });

      updateMainImage();
      propertyListSection.style.display = 'none';
      propertyDetailSection.style.display = 'block';
      window.scrollTo(0, 0);
    }

    function updateMainImage() {
      const images = Array.isArray(currentProperty.foto) && currentProperty.foto.length > 0
        ? currentProperty.foto
        : ['https://via.placeholder.com/600x400'];

      mainImage.src = images[currentImageIndex];
      document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
        thumb.classList.toggle('active', i === currentImageIndex);
      });
    }

    function setupEventListeners() {
      backToListBtn.addEventListener('click', () => {
        propertyDetailSection.style.display = 'none';
        propertyListSection.style.display = 'block';
      });

      prevBtn.addEventListener('click', () => {
        const images = Array.isArray(currentProperty.foto) && currentProperty.foto.length > 0
          ? currentProperty.foto
          : ['https://via.placeholder.com/600x400'];
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        updateMainImage();
      });

      nextBtn.addEventListener('click', () => {
        const images = Array.isArray(currentProperty.foto) && currentProperty.foto.length > 0
          ? currentProperty.foto
          : ['https://via.placeholder.com/600x400'];
        currentImageIndex = (currentImageIndex + 1) % images.length;
        updateMainImage();
      });

      loadButton.addEventListener('click', fetchAndDisplayProperties);
      refreshButton.addEventListener('click', fetchAndDisplayProperties);
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
